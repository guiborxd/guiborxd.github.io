<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Leitura da Bíblia | Farol da Fé</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Lora:ital,wght@0,400..700;1,400..700&family=Montserrat:wght@400;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Montserrat', sans-serif; }
        h1, h2, h3 { font-family: 'Lora', serif; }
        .versiculo-numero {
            font-weight: bold;
            color: #a16207; /* Cor âmbar escura */
            float: left;
            margin-right: 8px;
            font-size: 0.8em;
            line-height: 1.5;
        }
    </style>
</head>
<body class="bg-amber-50 text-stone-800">

    <!-- Cabeçalho e Navegação -->
    <header class="bg-stone-800 text-white shadow-lg">
        <nav class="container mx-auto px-6 py-4 flex justify-between items-center">
            <a href="index.html" class="text-2xl font-bold font-family-lora">Farol da Fé</a>
            <div class="space-x-4">
                <a href="index.html" class="hover:text-amber-300 transition-colors">Início</a>
                <a href="livros.html" class="hover:text-amber-300 transition-colors">Livros da Bíblia</a>
            </div>
        </nav>
    </header>

    <!-- Conteúdo Principal -->
    <main class="container mx-auto px-6 py-12">
        <div id="loading" class="text-center text-xl"><p>Carregando conteúdo...</p></div>

        <div id="conteudo-leitura" class="hidden">
            <h1 id="nome-livro" class="text-4xl font-bold text-center text-stone-800 mb-4"></h1>
            <h2 id="capitulo-selecionado" class="text-2xl text-center text-stone-600 mb-8"></h2>

            <!-- Seletor de Capítulos -->
            <div class="mb-8 text-center">
                <label for="seletor-capitulos" class="mr-2">Escolha um capítulo:</label>
                <select id="seletor-capitulos" class="p-2 rounded-md border-2 border-stone-300"></select>
            </div>

            <!-- Container dos Versículos -->
            <div id="versiculos-container" class="bg-white p-6 md:p-8 rounded-lg shadow-md text-lg leading-relaxed">
                <!-- Versículos serão inseridos aqui -->
            </div>
        </div>
    </main>

    <!-- Rodapé -->
    <footer class="bg-stone-800 text-white text-center p-6 mt-12">
        <p>&copy; 2025 Farol da Fé. Todos os direitos reservados.</p>
    </footer>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            const params = new URLSearchParams(window.location.search);
            const abbrev = params.get('abbrev');

            const loadingEl = document.getElementById('loading');
            const conteudoEl = document.getElementById('conteudo-leitura');
            const nomeLivroEl = document.getElementById('nome-livro');
            const capituloSelecionadoEl = document.getElementById('capitulo-selecionado');
            const seletorCapitulosEl = document.getElementById('seletor-capitulos');
            const versiculosContainerEl = document.getElementById('versiculos-container');

            if (!abbrev) {
                loadingEl.innerHTML = '<p>Nenhum livro selecionado. Volte para a <a href="livros.html" class="underline">lista de livros</a>.</p>';
                return;
            }

            // Função para buscar e exibir os versículos de um capítulo
            function carregarCapitulo(capitulo) {
                versiculosContainerEl.innerHTML = '<p>Carregando versículos...</p>';
                capituloSelecionadoEl.textContent = `Capítulo ${capitulo}`;

                const apiUrl = `https://www.abibliadigital.com.br/api/verses/nvi/${abbrev}/${capitulo}`;
                const proxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(apiUrl)}`;

                fetch(proxyUrl)
                    .then(response => {
                        if (response.ok) return response.json();
                        throw new Error('A resposta da rede não foi ok.');
                    })
                    .then(data => {
                        const chapterData = JSON.parse(data.contents);
                        versiculosContainerEl.innerHTML = '';
                        chapterData.verses.forEach(v => {
                            const p = document.createElement('p');
                            p.innerHTML = `<span class="versiculo-numero">${v.number}</span> ${v.text}`;
                            p.className = "mb-3";
                            versiculosContainerEl.appendChild(p);
                        });
                    })
                    .catch(error => {
                        console.error('Erro ao buscar versículos:', error);
                        versiculosContainerEl.innerHTML = '<p>Erro ao carregar os versículos.</p>';
                    });
            }

            // Busca os detalhes do livro para popular o seletor de capítulos
            const bookApiUrl = `https://www.abibliadigital.com.br/api/books/${abbrev}`;
            const bookProxyUrl = `https://api.allorigins.win/get?url=${encodeURIComponent(bookApiUrl)}`;

            fetch(bookProxyUrl)
                .then(response => {
                    if (response.ok) return response.json();
                    throw new Error('A resposta da rede não foi ok.');
                })
                .then(data => {
                    const livroData = JSON.parse(data.contents);
                    nomeLivroEl.textContent = livroData.name;
                    
                    for (let i = 1; i <= livroData.chapters; i++) {
                        const option = document.createElement('option');
                        option.value = i;
                        option.textContent = i;
                        seletorCapitulosEl.appendChild(option);
                    }

                    seletorCapitulosEl.addEventListener('change', (e) => {
                        carregarCapitulo(e.target.value);
                    });

                    carregarCapitulo(1);

                    loadingEl.style.display = 'none';
                    conteudoEl.classList.remove('hidden');
                })
                .catch(error => {
                    console.error('Erro ao buscar detalhes do livro:', error);
                    loadingEl.innerHTML = '<p>Não foi possível carregar o livro. Tente novamente.</p>';
                });
        });
    </script>
</body>
</html>
